<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js">
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  jax: ["input/MathML","output/SVG"],
  extensions: ["mml2jax.js","MathEvents.js"],
  MathML: {
  extensions: ["content-mathml.js"]
  },
  SVG: {
  //font: "STIX-Web",
  mtextFontInherit: true,
   blacker: 1,
  linebreaks: { automatic: true },
  useFontCache: false
  },
  menuSettings: {
  zoom: "Click"
  },
  MatchWebFonts: {
  matchFor: {
  //https://github.com/electron/electron/issues/6564
  // use fontcache off
  SVG: {useFontCache: false}
  },
  fontCheckDelay: 500,
  fontCheckTimeout: 15 * 1000
  },
  messageStyle: "none"
  });

  /*
  clientHeight
  clientWidth
  */
  
  var getImage  = function(){
      var svg = document.getElementsByTagName("svg")[3]

     
     var canvas = document.getElementById("myCanvas");
     
     drawInlineSVG(svg, 
     
      function(){
          var image = canvas.toDataURL("image/png");

          //console.log(image)
          
          google.script.run.withSuccessHandler(function(){console.log("success") }).withFailureHandler(function(error){console.log("error"); console.log(error)}).setImage(image.split("base64,")[1]);
      }
    )    
  }
  
  /*
    accept a svg and will perfect construct a canvas to match
    the dimension of the svg
  */
  function drawInlineSVG(svgElement, callback){
    var svgURL = new XMLSerializer().serializeToString(svgElement);
    var canvas = document.getElementById("myCanvas");
    var ratioSvg = svgElement.clientHeight/svgElement.clientWidth;
    var heigthSvg =  canvas.width * ratioSvg;
    canvas.height = heigthSvg; //look nicer with heightSvg + heightSvg *.2
    var img  = new Image();
    img.onload = function(){                      //width // height
      canvas.getContext('2d').drawImage(this, 0,0, canvas.width, canvas.height);
      callback();
    }
    img.src = 'data:image/svg+xml; charset=utf8, '+encodeURIComponent(svgURL);
  }
  


</script>